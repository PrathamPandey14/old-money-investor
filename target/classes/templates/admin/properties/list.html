<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Properties</title>
    <style>
        :root {
          --bg-1:#000; --bg-2:#222;
          --accent:#1DCD9F; --accent-dark:#169976;
          --radius:14px; --shadow:0 14px 30px rgba(0,0,0,0.5);
        }
        *{box-sizing:border-box;margin:0;padding:0}
        body{font-family:Inter,'Segoe UI',sans-serif;background:linear-gradient(180deg,var(--bg-2),#070707);color:#eaf7f2;min-height:100vh}

        /* Navbar */
        .nav{display:flex;justify-content:space-between;align-items:center;padding:18px 24px;background:rgba(0,0,0,.35);backdrop-filter:blur(8px);border-bottom:1px solid rgba(255,255,255,.06);position:sticky;top:0;z-index:40}
        .brand{display:flex;align-items:center;gap:10px;color:var(--accent);font-weight:800;text-decoration:none}
        .brand .logo{width:38px;height:38px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-dark));display:flex;align-items:center;justify-content:center;color:#001;font-weight:900}
        .create-btn{background:linear-gradient(90deg,var(--accent),var(--accent-dark));color:#001;padding:9px 14px;border-radius:10px;font-weight:700;text-decoration:none;transition:transform .25s}
        .create-btn:hover{transform:translateY(-2px)}

        /* Layout */
        .container{max-width:1200px;margin:0 auto;padding:28px 16px}
        h2{font-size:1.7rem;margin-bottom:20px;color:#f3fff9}
        .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(310px,1fr));gap:22px}

        /* Card */
        .card{background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.015));border-radius:var(--radius);padding:16px;border:1px solid rgba(255,255,255,.05);box-shadow:var(--shadow);display:flex;flex-direction:column;gap:14px;transition:transform .3s,box-shadow .3s;min-height:450px;position:relative}
        .card:hover{transform:translateY(-6px);box-shadow:0 20px 46px rgba(0,0,0,.65)}

        /* Carousel */
        .carousel{position:relative;width:100%;height:180px;overflow:hidden;border-radius:12px}
        .carousel-track{display:flex;transition:transform .5s ease;height:100%}
        .carousel-track img{width:100%;object-fit:cover;flex-shrink:0;height:100%}
        .carousel button{position:absolute;top:50%;transform:translateY(-50%);background:rgba(0,0,0,0.4);color:white;border:none;padding:6px 10px;border-radius:50%;cursor:pointer}
        .carousel .prev{left:6px}
        .carousel .next{right:6px}

        .no-thumb{width:100%;height:180px;border-radius:12px;display:flex;align-items:center;justify-content:center;background:rgba(29,205,159,.08);color:var(--accent);font-weight:700}

        .meta{display:flex;flex-direction:column;gap:4px}
        .title{font-weight:800;font-size:1.1rem}
        .muted{font-size:.9rem;color:rgba(234,247,242,.7)}
        .price{font-weight:700;color:var(--accent);margin-top:2px}

        /* Details always visible */
        .details{background:rgba(255,255,255,.02);border-radius:10px;padding:10px 12px;max-height:none;overflow:visible}
        .details ul{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:3px;font-size:.85rem;color:rgba(234,247,242,.75)}
        .details li b{color:#fff}

        /* Footer */
        .card-footer{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px;margin-top:auto}
        .actions{display:flex;gap:10px}
        .edit-btn,.delete-btn{padding:6px 12px;border-radius:10px;font-weight:700;cursor:pointer;transition:.25s}
        .edit-btn{text-decoration:none;background:linear-gradient(90deg,#fff,#eee);color:#001}
        .edit-btn:hover{transform:translateY(-2px)}
        .delete-btn{background:transparent;border:none;color:#ff8b8b}
        .delete-btn:hover{color:#ff5c5c}

        /* Reveal animation */
        .reveal{opacity:0;transform:translateY(18px) scale(.985);transition:opacity .6s,transform .6s}
        .reveal.show{opacity:1;transform:none}

        @media(max-width:1024px){
          .card{min-height:470px}
        }
    </style>
</head>
<body>
<nav class="nav">
    <a class="brand" th:href="@{/admin}">
        <span class="logo">OMI</span><span>Admin Panel</span>
    </a>
    <a th:href="@{/admin/properties/create}" class="create-btn">+ Add Property</a>
</nav>

<main class="container">
    <h2>All Properties</h2>
    <section class="grid" id="propertiesGrid">
        <article class="card reveal" th:each="p : ${properties}">

            <!-- Carousel or No Image -->
            <div th:if="${!#lists.isEmpty(p.imageList)}" class="carousel" th:attr="id='carousel'+${p.id}">
                <div class="carousel-track" th:attr="id='track'+${p.id}">
                    <img th:each="img : ${p.imageList}" th:src="@{${img}}" alt="Property Image"/>
                </div>
                <button class="prev" type="button" th:onclick="'moveCarousel(' + ${p.id} + ', -1)'">❮</button>
                <button class="next" type="button" th:onclick="'moveCarousel(' + ${p.id} + ', 1)'">❯</button>
            </div>
            <div class="no-thumb" th:if="${#lists.isEmpty(p.imageList)}">No Image</div>

            <div class="meta">
                <div class="title" th:text="${p.title}">Property Title</div>
                <div class="muted" th:text="${p.location}">Location</div>
                <div class="price" th:text="'₹ ' + ${p.price}">Price</div>
            </div>

            <div class="details">
                <ul>
                    <li><b>Developer:</b> <span th:text="${p.developer}">Dev</span></li>
                    <li><b>Bedrooms:</b> <span th:text="${p.bedrooms}">3</span> | <b>Bathrooms:</b> <span th:text="${p.bathrooms}">2</span> | <b>Balcony:</b> <span th:text="${p.balcony}">1</span></li>
                    <li><b>Transaction:</b> <span th:text="${p.transactionType}">Sale</span></li>
                    <li><b>Status:</b> <span th:text="${p.status}">Available</span></li>
                    <li><b>Facing:</b> <span th:text="${p.facing}">East</span></li>
                    <li><b>Furnished:</b> <span th:text="${p.furnishedStatus}">Semi-Furnished</span></li>
                    <li><b>Ownership:</b> <span th:text="${p.typeOfOwnership}">Freehold</span></li>
                    <li><b>Carpet Area:</b> <span th:text="${p.carpetArea}">1200</span> sq.ft</li>
                    <li><b>Floor:</b> <span th:text="${p.floor}">5</span> | <b>Age:</b> <span th:text="${p.ageOfConstruction}">3 yrs</span></li>
                    <li><b>Booking Amount:</b> <span th:text="${p.bookingAmount}">₹50,000</span></li>
                    <li><b>Furnishing:</b> <span th:text="${p.furnishing}">Modular Kitchen</span></li>
                    <li><b>Flooring:</b> <span th:text="${p.flooring}">Marble</span></li>
                    <li><b>Overlooking:</b> <span th:text="${p.overlooking}">Garden</span></li>
                    <li><b>Additional Rooms:</b> <span th:text="${p.additionalRooms}">Study</span></li>
                    <li><b>Floors Allowed:</b> <span th:text="${p.floorsAllowed}">10</span></li>
                    <li><b>Approval:</b> <span th:text="${p.authorityApproval}">RERA</span></li>
                    <li><b>Amenities:</b> <span th:text="${p.amenities}">Pool, Gym</span></li>
                    <li><b>Created:</b> <span th:text="${#temporals.format(p.createdAt,'dd MMM yyyy HH:mm')}"></span></li>
                    <li><b>Updated:</b> <span th:text="${#temporals.format(p.updatedAt,'dd MMM yyyy HH:mm')}"></span></li>
                </ul>
            </div>

            <div class="card-footer">
                <div class="actions">
                    <a th:href="@{'/admin/properties/edit/' + ${p.id}}" class="edit-btn">Edit</a>
                    <form th:action="@{'/admin/properties/delete/' + ${p.id}}" method="post" style="display:inline">
                        <button type="submit" class="delete-btn">Delete</button>
                    </form>
                </div>
            </div>
        </article>
    </section>
</main>

<script>
    const observer = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{ if(e.isIntersecting) e.target.classList.add('show'); });
    },{threshold:.12});
    document.querySelectorAll('.reveal').forEach(el=>observer.observe(el));

    // Carousel functionality
    const carouselIndexes = {};
    function moveCarousel(id, step){
        const track = document.getElementById('track'+id);
        const items = track.children.length;
        if(!carouselIndexes[id]) carouselIndexes[id]=0;
        carouselIndexes[id] = (carouselIndexes[id]+step+items)%items;
        track.style.transform = `translateX(-${carouselIndexes[id]*100}%)`;
    }
</script>
</body>
</html>
