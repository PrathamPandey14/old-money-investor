<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Blogs</title>
    <style>
        :root{
            --bg-1:#000000;
            --bg-2:#222222;
            --accent:#1DCD9F;
            --accent-dark:#169976;
            --radius:12px;
        }
        *{box-sizing:border-box;margin:0;padding:0}
        body{
            font-family:Inter, 'Segoe UI',sans-serif;
            background:linear-gradient(180deg,var(--bg-2),#070707);
            color:#eaf7f2;
            min-height:100vh;
            width:100%;
            overflow-x:hidden;
        }

        /* Navbar */
        .nav{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;padding:18px 24px;border-bottom:1px solid rgba(255,255,255,0.03);position:sticky;top:0;background:linear-gradient(180deg, rgba(0,0,0,0.25), rgba(0,0,0,0.15));backdrop-filter: blur(6px);z-index:40;}
        .brand{display:flex;gap:12px;align-items:center;color:var(--accent);text-decoration:none;font-weight:800;}
        .brand .logo{width:40px;height:40px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-dark));display:inline-flex;align-items:center;justify-content:center;color:#001;}
        .controls{display:flex;gap:12px;align-items:center;flex-wrap:wrap;}
        .create-btn{background:linear-gradient(90deg,var(--accent),var(--accent-dark));color:#001;padding:8px 12px;border-radius:10px;text-decoration:none;font-weight:700;white-space:nowrap;}

        /* Container */
        .container{max-width:1200px;padding:22px 12px;margin:0 auto;}
        h2{margin-bottom:12px;font-size:1.5rem}

        /* Grid cards */
        .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;}
        @media (max-width:1000px){.grid{grid-template-columns:repeat(2,1fr);gap:16px}}
        @media (max-width:640px){.grid{grid-template-columns:1fr;gap:14px}}

        .card{
            background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
            border-radius:var(--radius);
            padding:14px;
            border:1px solid rgba(255,255,255,0.04);
            box-shadow:0 18px 40px rgba(0,0,0,0.5);
            display:flex;
            flex-direction:column;
            gap:10px;
            transition:transform .28s cubic-bezier(.2,.9,.3,1),box-shadow .28s;
        }
        .card:hover{transform:translateY(-8px);box-shadow:0 30px 60px rgba(0,0,0,0.6)}

        /* Carousel inside cards */
        .carousel{position:relative;width:100%;margin:0 auto;overflow:hidden;border-radius:10px;}
        .carousel-inner{display:flex;transition:transform 0.35s ease-in-out;touch-action:pan-y;}
        .carousel-inner img{width:100%;height:160px;object-fit:cover;flex-shrink:0;border-radius:10px;}
        .carousel-btn{position:absolute;top:50%;transform:translateY(-50%);background:rgba(0,0,0,0.4);color:#fff;border:none;font-size:1.2rem;cursor:pointer;padding:4px 8px;border-radius:50%;transition:background 0.3s;z-index:10;}
        .carousel-btn:hover{background:rgba(0,0,0,0.7);}
        .carousel-btn.prev{left:8px;}
        .carousel-btn.next{right:8px;}
        .carousel-dots{display:flex;justify-content:center;gap:6px;margin-top:6px;}
        .carousel-dots span{width:8px;height:8px;border-radius:50%;background:rgba(255,255,255,0.3);cursor:pointer;}
        .carousel-dots .active{background:var(--accent);}

        .meta{display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap;}
        .title{font-weight:800;font-size:1rem;word-break:break-word;}
        .cat{padding:6px 8px;border-radius:999px;background:rgba(29,205,159,0.08);color:var(--accent);font-weight:700;font-size:0.85rem;white-space:nowrap;}
        .excerpt{color:rgba(234,247,242,0.8);font-size:.95rem;line-height:1.35;word-break:break-word;}
        .card-footer{display:flex;align-items:center;justify-content:space-between;margin-top:auto;flex-wrap:wrap;gap:8px;}
        .actions{display:flex;gap:8px;flex-wrap:wrap;}
        .edit-btn{padding:6px 10px;border-radius:10px;text-decoration:none;background:linear-gradient(90deg,#fff 0%,#fff 0%);color:#001;font-weight:700;white-space:nowrap;}
        .delete-btn{padding:6px 10px;border-radius:10px;border:none;background:transparent;color:#ff8b8b;font-weight:700;cursor:pointer;white-space:nowrap;}

        /* Reveal animation */
        .reveal{opacity:0;transform:translateY(16px) scale(.995);transition:opacity .6s,transform .6s;}
        .reveal.show{opacity:1;transform:none}
    </style>
</head>
<body>
<nav class="nav">
    <a class="brand" th:href="@{/admin}"><span class="logo">OMI</span><span>Admin Panel</span></a>
    <div class="controls">
        <a th:href="@{/admin/blogs/create}" class="create-btn">+ Create New Blog</a>
    </div>
</nav>

<main class="container">
    <h2>Blogs</h2>
    <section class="grid" id="postsGrid">
        <article class="card reveal" th:each="b, iter : ${blogs}">
            <!-- Carousel for blog images -->
            <div class="carousel" th:id="'carousel-'+${iter.index}">
                <button class="carousel-btn prev" onclick="moveSlide(this,-1)">❮</button>
                <div class="carousel-inner">
                    <img th:each="img : ${b.imageList}" th:src="@{${img}}" alt="Blog Image" />
                </div>
                <button class="carousel-btn next" onclick="moveSlide(this,1)">❯</button>
            </div>
            <div class="carousel-dots"></div>

            <div class="meta">
                <div>
                    <div class="title" th:text="${b.title}">Sample title</div>
                    <div class="muted" style="font-size:.9rem;color:rgba(234,247,242,0.6)" th:text="${b.author}">Author</div>
                </div>
                <div class="cat" th:text="${b.blogCategory}">Category</div>
            </div>

            <p class="excerpt" th:text="${b.content}">Content</p>

            <div class="card-footer">
                <div class="muted" th:text="${b.blogType}">Type</div>
                <div class="actions">
                    <a th:href="@{'/admin/blogs/edit/' + ${b.id}}" class="edit-btn">Edit</a>
                    <form th:action="@{'/admin/blogs/delete/' + ${b.id}}" method="post" style="display:inline">
                        <button type="submit" class="delete-btn">Delete</button>
                    </form>
                </div>
            </div>
        </article>
    </section>
</main>

<script>
    // Reveal on scroll
    const observer = new IntersectionObserver((entries)=>{
        entries.forEach(e=>{ if(e.isIntersecting) e.target.classList.add('show'); });
    },{threshold:.12});
    document.querySelectorAll('.reveal').forEach(el=>observer.observe(el));

    // Carousel logic (shared for all cards)
    function moveSlide(btn, step){
        const carousel = btn.closest('.carousel');
        const inner = carousel.querySelector('.carousel-inner');
        const dots = carousel.parentElement.querySelector('.carousel-dots');
        const total = inner.children.length;
        if(total === 0) return;

        let index = parseInt(carousel.dataset.index || "0");
        index = (index + step + total) % total;
        carousel.dataset.index = index;

        const width = inner.children[0].clientWidth;
        inner.style.transform = `translateX(${-index * width}px)`;

        // update dots
        Array.from(dots.children).forEach((d,i)=> d.classList.toggle("active", i===index));
    }

    // Setup all carousels
    document.querySelectorAll('.carousel').forEach(carousel=>{
        const inner = carousel.querySelector('.carousel-inner');
        const total = inner.children.length;
        carousel.dataset.index = 0;

        // Dots
        const dotsContainer = carousel.parentElement.querySelector('.carousel-dots');
        dotsContainer.innerHTML="";
        for(let i=0;i<total;i++){
            const dot=document.createElement("span");
            if(i===0) dot.classList.add("active");
            dot.addEventListener("click",()=>{
                carousel.dataset.index=i;
                inner.style.transform=`translateX(${-i * inner.children[0].clientWidth}px)`;
                Array.from(dotsContainer.children).forEach((d,j)=> d.classList.toggle("active", j===i));
            });
            dotsContainer.appendChild(dot);
        }

        // Swipe support
        let startX=0,endX=0;
        carousel.addEventListener("touchstart", e=>{startX=e.touches[0].clientX;});
        carousel.addEventListener("touchend", e=>{
            endX=e.changedTouches[0].clientX;
            const diff=startX-endX;
            if(Math.abs(diff)>50){ moveSlide(carousel.querySelector(diff>0?".next":".prev"), diff>0?1:-1); }
        });
    });
</script>
</body>
</html>
