<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Edit Blog</title>
    <style>
        :root{--bg-1:#000000;--bg-2:#222222;--accent:#1DCD9F;--accent-dark:#169976;--radius:14px}
        *{box-sizing:border-box;margin:0;padding:0}
        body{font-family:Inter, 'Segoe UI', sans-serif;background:linear-gradient(180deg,var(--bg-2),#070707);color:#e9f5f2;padding:36px}
        .wrap{max-width:980px;margin:0 auto}
        .nav{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}
        .brand{color:var(--accent);font-weight:700;text-decoration:none}
        .brand .logo{width:36px;height:36px;border-radius:8px;background:linear-gradient(135deg,var(--accent),var(--accent-dark));display:inline-flex;align-items:center;justify-content:center;color:#001010;font-weight:800;}
        .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:26px;border-radius:var(--radius);border:1px solid rgba(255,255,255,0.04);box-shadow:0 14px 30px rgba(0,0,0,0.5);backdrop-filter: blur(8px)}

        h1{color:#f3fff9;margin-bottom:8px}
        .muted{color:rgba(230,238,240,0.65)}

        form .col{display:grid;grid-template-columns:1fr 1fr;gap:14px}
        @media (max-width:820px){form .col{grid-template-columns:1fr}}

        label{display:block;margin-bottom:6px;font-weight:600;color:rgba(230,238,240,0.9)}
        input,select,textarea{width:100%;padding:12px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.05);color:inherit}
        input:focus,select:focus,textarea:focus{outline:none;box-shadow:0 8px 24px rgba(25,180,140,0.06);border-color:var(--accent)}

        .existing-images{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px}
        .existing-images img{width:110px;height:72px;object-fit:cover;border-radius:8px;border:1px solid rgba(255,255,255,0.04)}

        .actions{display:flex;gap:12px;margin-top:14px}
        .btn{background:linear-gradient(90deg,var(--accent),var(--accent-dark));color:#001;padding:.6rem .9rem;border-radius:10px;border:none;font-weight:700}
        .ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:.45rem .7rem;border-radius:10px;color:inherit}

        /* Carousel */
        .carousel{position:relative;width:100%;max-width:640px;margin:16px auto;overflow:hidden;border-radius:12px;box-shadow:0 14px 30px rgba(0,0,0,0.5);background:rgba(255,255,255,0.02);}
        .carousel-inner{display:flex;transition:transform 0.35s ease-in-out;touch-action:pan-y;}
        .carousel-inner img{width:100%;height:300px;object-fit:cover;flex-shrink:0;border-radius:12px;}
        .carousel-btn{position:absolute;top:50%;transform:translateY(-50%);background:rgba(0,0,0,0.4);color:#fff;border:none;font-size:1.5rem;cursor:pointer;padding:8px 12px;border-radius:50%;transition:background 0.3s;z-index:10;}
        .carousel-btn:hover{background:rgba(0,0,0,0.7);}
        .carousel-btn.prev{left:10px;}
        .carousel-btn.next{right:10px;}
        .carousel-dots{display:flex;justify-content:center;gap:8px;margin-top:8px;}
        .carousel-dots span{width:10px;height:10px;border-radius:50%;background:rgba(255,255,255,0.3);cursor:pointer;}
        .carousel-dots .active{background:var(--accent);}

        /* reveal */
        .reveal{opacity:0;transform:translateY(12px);transition:opacity .6s,transform .6s}
        .reveal.show{opacity:1;transform:none}
    </style>
</head>
<body>
<div class="wrap">
    <nav class="nav reveal">
        <a class="brand" th:href="@{/admin}">
            <span class="logo">OMI</span>
            <span>Admin Panel</span>
        </a>
    </nav>

    <main class="card reveal">
        <h1>Edit Blog</h1>
        <p class="muted">Make changes and update the post — Thymeleaf bindings remain unchanged.</p>

        <form th:action="@{'/admin/blogs/edit/' + ${blogDto.id}}" th:object="${blogDto}" method="post" enctype="multipart/form-data">
            <div class="col">
                <div>
                    <label>Title</label>
                    <input type="text" th:field="*{title}" placeholder="Enter blog title" required>

                    <label style="margin-top:8px">Author</label>
                    <input type="text" th:field="*{author}" placeholder="Author name" required>

                    <label style="margin-top:8px">Blog Type</label>
                    <select th:field="*{blogType}" required>
                        <option value="" disabled>Select Type</option>
                        <option value="Personal" th:selected="${blogDto.blogType=='Personal'}">Personal</option>
                        <option value="Technical" th:selected="${blogDto.blogType=='Technical'}">Technical</option>
                        <option value="News" th:selected="${blogDto.blogType=='News'}">News</option>
                    </select>
                </div>

                <div>
                    <label>Content</label>
                    <textarea th:field="*{content}" rows="8" placeholder="Write your blog content here..." required></textarea>

                    <label style="margin-top:8px">Blog Category</label>
                    <select th:field="*{blogCategory}" required>
                        <option value="" disabled>Select Category</option>
                        <option value="Java" th:selected="${blogDto.blogCategory=='Java'}">Java</option>
                        <option value="Spring Boot" th:selected="${blogDto.blogCategory=='Spring Boot'}">Spring Boot</option>
                        <option value="Finance" th:selected="${blogDto.blogCategory=='Finance'}">Finance</option>
                        <option value="Motivation" th:selected="${blogDto.blogCategory=='Motivation'}">Motivation</option>
                    </select>
                </div>
            </div>

            <!-- Upload + Carousel -->
            <label style="margin-top:14px">Upload New Images</label>
            <input type="file" name="files" multiple onchange="previewImages(event,'carouselInnerEdit','carouselDotsEdit')">

            <div class="carousel" id="imageCarouselEdit">
                <button class="carousel-btn prev" onclick="moveSlideEdit(-1)" type="button">❮</button>
                <div class="carousel-inner" id="carouselInnerEdit"></div>
                <button class="carousel-btn next" onclick="moveSlideEdit(1)" type="button">❯</button>
            </div>
            <div class="carousel-dots" id="carouselDotsEdit"></div>

            <!-- Existing images -->
            <p style="margin-top:12px">Existing Images:</p>
            <div class="existing-images">
                <img th:each="img : ${blogDto.imageList}" th:src="@{${img}}" alt="Existing image"/>
            </div>

            <div class="actions">
                <button type="submit" class="btn">Update Blog</button>
                <a th:href="@{/admin/blogs}" class="ghost">← Back to Blogs</a>
            </div>
        </form>
    </main>
</div>

<script>
    let currentSlideEdit = 0;
    let startXEdit = 0, endXEdit = 0;

    function previewImages(event, innerId, dotsId){
      const inner = document.getElementById(innerId);
      const dots = document.getElementById(dotsId);
      inner.innerHTML = '';
      dots.innerHTML = '';
      const files = event.target.files;

      Array.from(files).forEach((file, i)=>{
        if(file && file.type.startsWith("image/")){
          const reader = new FileReader();
          reader.onload = e=>{
            const img=document.createElement("img");
            img.src=e.target.result;
            inner.appendChild(img);

            const dot=document.createElement("span");
            if(i===0) dot.classList.add("active");
            dot.addEventListener("click",()=>{
              currentSlideEdit=i;
              updateCarouselEdit();
            });
            dots.appendChild(dot);
          };
          reader.readAsDataURL(file);
        }
      });

      currentSlideEdit = 0;
      updateCarouselEdit();
    }

    function moveSlideEdit(step){
      const inner=document.getElementById("carouselInnerEdit");
      const total=inner.children.length;
      if(total===0) return;
      currentSlideEdit=(currentSlideEdit+step+total)%total;
      updateCarouselEdit();
    }

    function updateCarouselEdit(){
      const inner=document.getElementById("carouselInnerEdit");
      const dots=document.getElementById("carouselDotsEdit").children;
      const total=inner.children.length;
      if(total===0) return;

      const width=inner.children[0].clientWidth;
      inner.style.transform=`translateX(${-currentSlideEdit * width}px)`;

      Array.from(dots).forEach((d,i)=>d.classList.toggle("active", i===currentSlideEdit));
    }

    // Swipe gestures
    const carouselEdit=document.getElementById("imageCarouselEdit");
    if(carouselEdit){
      carouselEdit.addEventListener("touchstart", e=>{startXEdit=e.touches[0].clientX;});
      carouselEdit.addEventListener("touchend", e=>{
        endXEdit=e.changedTouches[0].clientX;
        const diff=startXEdit-endXEdit;
        if(Math.abs(diff)>50){ diff>0 ? moveSlideEdit(1):moveSlideEdit(-1);}
      });
    }

    // Reveal animation
    const observer=new IntersectionObserver((entries)=>{
      entries.forEach(e=>{ if(e.isIntersecting) e.target.classList.add('show'); });
    },{threshold:.12});
    document.querySelectorAll('.reveal').forEach(el=>observer.observe(el));
</script>
</body>
</html>
